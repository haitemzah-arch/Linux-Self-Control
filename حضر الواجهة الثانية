#!/usr/bin/env python3
"""
Private Space Killer - ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø®Ø§Øµ ÙƒÙ„ÙŠØ§Ù‹
ÙŠÙˆÙ‚Ù Ù…ÙŠØ²Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ Ø¹Ø¨Ø± ADB
ØªØ´ØºÙŠÙ„: python3 private_space_killer.py
"""
import subprocess
import sys

PACKAGE = "com.miui.securitycore"
ACTIVITY = "com.miui.securityspace.ui.activity.PrivateSpaceMainActivity"

def adb(cmd: list, timeout=10) -> tuple:
    result = subprocess.run(
        ["adb"] + cmd,
        capture_output=True,
        timeout=timeout
    )
    stdout = result.stdout.decode(errors="ignore").strip()
    stderr = result.stderr.decode(errors="ignore").strip()
    return stdout, stderr

def check_adb():
    out, _ = adb(["devices"])
    lines = [l for l in out.strip().splitlines() if "device" in l and "List" not in l]
    if not lines:
        print("âŒ  Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ù‡Ø§Ø² Ù…ØªØµÙ„! ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ USB Debugging")
        sys.exit(1)
    print(f"âœ…  Ø¬Ù‡Ø§Ø² Ù…ØªØµÙ„: {lines[0].split()[0]}")

def get_package_state() -> str:
    out, _ = adb(["shell", "pm", "list", "packages", "-d"])
    if PACKAGE in out:
        return "disabled"
    out2, _ = adb(["shell", "pm", "list", "packages", "-e"])
    if PACKAGE in out2:
        return "enabled"
    return "unknown"

def disable_private_space():
    print("\nğŸ”¨  Ø¬Ø§Ø±ÙŠ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø®Ø§Øµ...")

    # 1. ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¨Ø§ÙƒØ¬ ÙƒÙ„ÙŠØ§Ù‹
    out, err = adb(["shell", "pm", "disable-user", "--user", "0", PACKAGE])
    print(f"   pkg disable  â†’ {out or err}")

    # 2. Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙÙˆØ±Ø§Ù‹
    out2, _ = adb(["shell", "am", "force-stop", PACKAGE])
    print(f"   force-stop   â†’ {'ØªÙ…' if not out2 else out2}")

    # 3. Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø§ÙƒØ¬ (Ø·Ø¨Ù‚Ø© Ø¥Ø¶Ø§ÙÙŠØ©)
    out3, _ = adb(["shell", "pm", "hide", PACKAGE])
    print(f"   hide pkg     â†’ {'ØªÙ…' if not out3 else out3}")

    # 4. ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù€ Activity ØªØ­Ø¯ÙŠØ¯Ø§Ù‹
    out4, _ = adb(["shell", "pm", "disable", f"{PACKAGE}/{ACTIVITY}"])
    print(f"   disable act  â†’ {out4 or 'ØªÙ…'}")

    print("\nâœ…  Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø®Ø§Øµ Ù…Ø¹Ø·Ù‘Ù„ ÙƒÙ„ÙŠØ§Ù‹! Ø§Ù„Ø²Ø± Ù„Ù† ÙŠØ¹Ù…Ù„.")

def enable_private_space():
    print("\nğŸ”“  Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø®Ø§Øµ...")

    out, err = adb(["shell", "pm", "enable", PACKAGE])
    print(f"   pkg enable   â†’ {out or err}")

    out2, _ = adb(["shell", "pm", "unhide", PACKAGE])
    print(f"   unhide pkg   â†’ {'ØªÙ…' if not out2 else out2}")

    out3, _ = adb(["shell", "pm", "enable", f"{PACKAGE}/{ACTIVITY}"])
    print(f"   enable act   â†’ {out3 or 'ØªÙ…'}")

    print("\nâœ…  Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø®Ø§Øµ Ù…ÙØ¹Ù‘Ù„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.")

def main():
    print("=" * 55)
    print("  ğŸ’€  Private Space Killer  ğŸ’€")
    print("     ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙƒÙ„ÙŠØ§Ù‹ - MIUI")
    print("=" * 55)

    check_adb()

    state = get_package_state()
    print(f"\nğŸ“Š  Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {'ğŸ”´ Ù…Ø¹Ø·Ù‘Ù„' if state == 'disabled' else 'ğŸŸ¢ Ù…ÙØ¹Ù‘Ù„' if state == 'enabled' else 'â“ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}")

    print("\nØ§Ø®ØªØ±:")
    print("  [1] ğŸ”´  ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø®Ø§Øµ ÙƒÙ„ÙŠØ§Ù‹")
    print("  [2] ğŸŸ¢  Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ (ØªØ±Ø§Ø¬Ø¹)")
    print("  [0] Ø®Ø±ÙˆØ¬")

    choice = input("\n> ").strip()

    if choice == "1":
        disable_private_space()
    elif choice == "2":
        enable_private_space()
    elif choice == "0":
        print("Ø®Ø±ÙˆØ¬.")
    else:
        print("âŒ  Ø§Ø®ØªÙŠØ§Ø± ØºÙŠØ± ØµØ­ÙŠØ­")

if __name__ == "__main__":
    main()
