#!/usr/bin/env python3
import pyatspi
import os
import time
import threading

# قائمة الكلمات التي تظهر في خانة البحث
FORBIDDEN_NAMES = ["search", "بحث", "buscar", "recherche"]

def on_focus_changed(event):
    try:
        accessible_obj = event.source
        obj_name = accessible_obj.name.lower() if accessible_obj.name else ""
        obj_role = accessible_obj.getRoleName()

        # التحقق إذا كان العنصر خانة إدخال نص
        if obj_role in ["text", "entry", "paragraph"]:
            for keyword in FORBIDDEN_NAMES:
                if keyword == obj_name:
                    # محاكاة Ctrl+W لإغلاق التبويب فوراً
                    os.system("xdotool key --clearmodifiers ctrl+w")
                    return
    except Exception:
        pass

def main():
    # تسجيل مستمع للأحداث
    pyatspi.Registry.registerEventListener(on_focus_changed, "object:state-changed:focused")
    
    # بدء الحلقة
    try:
        pyatspi.Registry.start()
    except KeyboardInterrupt:
        pass

if __name__ == "__main__":
    main()
